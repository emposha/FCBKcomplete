(function(d){d.fn.fcbkcomplete=function(V){return this.queue(function(){var r,u,v,w,J,K,x,y,L,M,N,O,P,Q;function W(){name=e.attr("name");b.bricket&&"undefined"!=typeof name&&-1==name.indexOf("[]")&&(name+="[]");var a=d("<"+e.get(0).tagName+' name="'+name+'" id="'+o+'" multiple="multiple" class="'+e.get(0).className+' hidden">').data("cache",{});d.each(e.children("option"),function(h,c){c=d(c);a.data("cache")[c.val()]=c.text();if(c.hasClass("selected")){var b=l(c.text(),c.val(),!0,c.hasClass("locked"));
a.append('<option value="'+c.val()+'" selected="selected" id="opt_'+b+'"class="selected">'+c.text()+"</option>")}});e.after(a);e.remove();e=a;d(e).bind("addItem",function(a,c){l(c.title,c.value,0,0,0)});d(e).bind("removeItem",function(a,c){var b=k.children("li[rel="+c.value+"]");b.length&&z(b)});d(e).bind("destroy",function(){k.remove();j.remove();e.show()});d(e).bind("selectAll",function(){var a=d(e).val()||[];d.each(d(e).data("cache"),function(c,b){-1===d.inArray(c,a)&&l(b,c,0,0,0)});f.parent().hide()})}
function l(a,h,c,f,g){if(!p())return!1;var j="bit-box"+(f?" locked":""),f=X(),l=document.createTextNode(b.show_values?n(h):n(a)),m=d('<a class="closebutton" href="#"></a>'),j=d('<li class="'+j+'" rel="'+h+'" id="pt_'+f+'"></li>').prepend(l).append(m);k.append(j);m.click(function(){z(d(this).parent("li"));return!1});c||(d("#"+o+"_annoninput").remove(),R(g),a=d('<option value="'+n(h,1)+'" id="opt_'+f+'" class="selected" selected="selected">'+n(a)+"</option>"),e.append(a),b.onselect&&A(b.onselect,a),
e.change());k.children("li.bit-box.deleted").removeClass("deleted");s(1);return f}function z(a){if(!a.hasClass("locked")){a.fadeOut("fast");var h=a.attr("id");if(b.onremove){var c=h?d("#o"+h+""):e.children("option[value="+a.attr("rel")+"]");A(b.onremove,c)}h?d("#o"+h+"").remove():e.children('option[value="'+a.attr("rel")+'"]').remove();a.remove();e.change();B=0}}function R(a){var h=d('<li class="bit-input" id="'+o+'_annoninput">'),c=d('<input type="text" class="maininput" size="'+b.input_min_size+
'" autocomplete="off">');0<b.input_tabindex&&c.attr("tabindex",b.input_tabindex);""!=b.input_name&&c.attr("name",b.input_name);k.append(h.append(c));c.focus(function(){C=!0;p()&&j.fadeIn("fast")});c.blur(function(){C=!1;D?j.fadeOut("fast"):c.focus()});k.click(function(){0>b.input_min_size&&f.length&&S(q(c.val(),1));c.focus();f.length&&c.val().length>b.input_min_size?f.show():(s(1),j.children(".default").show())});c.keypress(function(a){if(a.keyCode==r)return!1;a=b.input_min_size>c.val().length?b.input_min_size:
c.val().length+1;c.attr("size",a).width(parseInt(c.css("font-size"))*a)});c.keyup(function(a){var h=q(c.val(),1);if(a.keyCode==u&&0==h.length&&(s(1),!k.children("li.bit-box:last").hasClass("locked"))){if(0==k.children("li.bit-box.deleted").length)return k.children("li.bit-box:last").addClass("deleted"),!1;if(B)return;B=1;k.children("li.bit-box.deleted").fadeOut("fast",function(){z(d(this));return!1})}a.keyCode!=v&&a.keyCode!=w&&a.keyCode!=J&&a.keyCode!=K&&h.length>b.input_min_size&&(S(h),j.children(".default").hide(),
f.show())});b.oncreate&&A(b.oncreate,c);a&&setTimeout(function(){c.focus();j.children(".default").show()},1)}function E(a,h){f.html("");!b.cache&&null!=h&&m.clear();Y(a);null!=h&&h.length&&d.each(h,function(a,c){m.set(q(c.key),q(c.value))});var c=b.maxshownitems<m.length()?b.maxshownitems:m.length(),k="";d.each(m.search(a),function(h,d){if(c&&(!b.filter_selected||!e.children('option[value="'+d.key+'"]').hasClass("selected"))){var f=k,g='<li rel="'+d.key+'">',j=d.value,l=b.filter_begin?"<em>$1</em>$2":
"$1<em>$2</em>$3",m=(b.filter_begin?"":"(.*)")+(b.filter_case?"("+a+")(.*)":"("+a.toLowerCase()+")(.*)");try{j=j.replace(RegExp(m,b.filter_case?"g":"gi"),l)}catch(o){}k=f+(g+n(j)+"</li>");t++;c--}});f.append(k);b.firstselected&&(g=f.children("li:visible:first"),g.addClass("auto-focus"));t>b.height?f.css({height:24*b.height+"px",overflow:"auto"}):f.css("height","auto");p()&&j.is(":hidden")&&j.show()}function T(){f.children("li").mouseover(function(){f.children("li").removeClass("auto-focus");g=d(this);
g.addClass("auto-focus")});f.children("li").mouseout(function(){d(this).removeClass("auto-focus");g=null})}function Z(){f.unbind("mouseover").unbind("mouseout").mousemove(function(){T();f.unbind("mousemove")})}function F(){var a=d("#"+o+"_annoninput").children(".maininput");T();f.children("li").unbind("mousedown").mousedown(function(){var a=d(this);l(a.text(),a.attr("rel"),0,0,1);s(1);j.hide()});a.unbind("keydown");a.keydown(function(a){a.keyCode!=u&&k.children("li.bit-box.deleted").removeClass("deleted");
if((a.keyCode==r||a.keyCode==x||a.keyCode==y)&&!(null==g||0==g.length)){var c=g;l(c.text(),c.attr("rel"),0,0,1);return G(a)}if((a.keyCode==r||a.keyCode==x||a.keyCode==y)&&(null==g||0==g.length)){if(b.newel)return c=q(d(this).val()),l(c,c,0,0,1),G(a);if((b.addontab||b.addoncomma)&&b.newel)return c=g=f.children("li:visible:first"),l(c.text(),c.attr("rel"),0,0,1),G(a)}a.keyCode==v&&U("first");a.keyCode==w&&U("last")})}function U(a){Z();if(null==g||0==g.length)g=f.children("li:visible:"+a),f.get(0).scrollTop=
"first"==a?0:parseInt(g.get(0).scrollHeight,10)*(parseInt(f.children("li:visible").length,10)-Math.round(b.height/2));else{g.removeClass("auto-focus");g="first"==a?g.nextAll("li:visible:first"):g.prevAll("li:visible:first");var h=parseInt(g.prevAll("li:visible").length,10),c=parseInt(g.nextAll("li:visible").length,10);if((("first"==a?h:c)>Math.round(b.height/2)||("first"==a?h:c)<=Math.round(b.height/2))&&"undefined"!=typeof g.get(0))f.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(h-Math.round(b.height/
2))}f.children("li").removeClass("auto-focus");g.addClass("auto-focus")}function G(a){j.hide();a.preventDefault();g=null;return!1}function p(){return 0!=b.maxitems&&k.children("li.bit-box").length<b.maxitems}function Y(a){b.newel&&p()&&(f.children("li[fckb=1]").remove(),0!=a.length&&(a=d('<li rel="'+a+'" fckb="1">').html(n(a)),f.prepend(a),t++))}function A(a,b){var c={};for(i=0;i<b.get(0).attributes.length;i++)null!=b.get(0).attributes[i].nodeValue&&(c["_"+b.get(0).attributes[i].nodeName]=b.get(0).attributes[i].nodeValue);
return a.call(a,c)}function q(a,b){if("undefined"!=typeof b){for(i=0;i<a.length;i++){var c=a.charCodeAt(i);if(L<=c&&c<=M||N<=c&&c<=O||P<=c&&c<=Q)a=a.replace(a[i],escape(a[i]))}a=a.replace(/(\{|\}|\*)/i,"\\$1")}return a.replace(/script(.*)/g,"")}function n(a,b){a=a.toString();a=a.replace("\\","");return"undefined"!=typeof b?a:unescape(a)}function s(a){f.children().remove();a&&f.hide()}function S(a){t=0;if(b.json_url&&p())if(b.cache&&H.get(a))E(a),F();else{I++;var e=I;setTimeout(function(){e==I&&d.getJSON(b.json_url,
{tag:n(a)},function(c){C&&(E(a,c),H.set(a,1),F())})},b.delay)}else E(a),F()}var b=d.extend({json_url:null,width:512,cache:!1,height:"10",newel:!1,addontab:!1,addoncomma:!1,firstselected:!1,filter_case:!1,filter_selected:!1,filter_begin:!1,complete_text:"Start to type...",select_all_text:null,maxshownitems:30,maxitems:10,oncreate:null,onselect:null,onremove:null,attachto:null,delay:350,input_tabindex:0,input_min_size:1,input_name:"",bricket:!0,show_values:!1},V),k=null,f=null,j=null,t=0,C=!1,g=null,
B=0,D=1,e=d(this),o=e.attr("id"),I=0,H={set:function(a,b){var c=e.data("jsoncache");c[a]=b;e.data("jsoncache",c)},get:function(a){return"undefined"!=e.data("jsoncache")[a]?e.data("jsoncache")[a]:null},init:function(){e.data("jsoncache",{})}};r=13;x=9;y=188;u=8;J=37;w=38;K=39;v=40;L=33;M=47;N=58;O=64;P=91;Q=96;var X=function(){for(var a="",b=0;32>b;b++)var c=Math.floor(61*Math.random()),a=a+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(c,c+1);return a},m={search:function(a){var f=
[],c=RegExp((b.filter_begin?"^":"")+a,b.filter_case?"g":"gi");d.each(e.data("cache"),function(a,b){"function"===typeof b.search&&-1!=b.search(c)&&f.push({key:a,value:b})});return f},set:function(a,b){var c=e.data("cache");c[a]=b;e.data("cache",c)},get:function(a){return"undefined"!=e.data("cache")[a]?e.data("cache")[a]:null},clear:function(){e.data("cache",{})},length:function(){if("object"==typeof e.data("cache")){var a=0;for(i in e.data("cache"))a++;return a}return e.data("cache").length},init:function(){"undefined"==
e.data("cache")&&e.data("cache",{})}};(function(){k=d('<ul class="holder"></ul>').width(b.width);b.attachto?"object"==typeof b.attachto?b.attachto.append(k):d(b.attachto).append(k):e.after(k);j=d('<div class="facebook-auto">').width(b.width);""!=b.complete_text&&(j.append('<div class="default">'+b.complete_text+"</div>"),b.select_all_text&&j.children(".default").append(d('<a href="" class="select_all_items">'+b.select_all_text+"</a>").click(function(){d(e).trigger("selectAll");return!1})));j.hover(function(){D=
0},function(){D=1});f=d('<ul id="'+o+'_feed"></ul>').width(b.width);k.after(j.prepend(f));W()})();R(0);H.init();m.init();return this})}})(jQuery);
