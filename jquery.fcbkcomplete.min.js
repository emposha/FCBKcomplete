(function(d){d.fn.fcbkcomplete=function(W){return this.queue(function(){var r,u,v,w,K,L,x,y,M,N,O,P,Q,R;function X(){name=e.attr("name");c.bricket&&"undefined"!=typeof name&&-1==name.indexOf("[]")&&(name+="[]");var a=d("<"+e.get(0).tagName+' name="'+name+'" id="'+o+'" multiple="multiple" class="'+e.get(0).className+' hidden">').data("cache",{});d.each(e.children("option"),function(c,b){b=d(b);a.data("cache")[b.val()]=b.text();if(b.hasClass("selected")){var e=l(b.text(),b.val(),!0,b.hasClass("locked"));
a.append('<option value="'+b.val()+'" selected="selected" id="opt_'+e+'"class="selected">'+b.text()+"</option>")}});e.after(a);e.remove();e=a;d(e).bind("addItem",function(a,b){l(b.title,b.value,0,0,0)});d(e).bind("change",function(){c.onchange&&c.onchange.call(c.onchange)});d(e).bind("removeItem",function(a,b){var c=h.children("li[rel="+b.value+"]");c.length&&z(c)});d(e).bind("destroy",function(){h.remove();j.remove();e.show()});d(e).bind("selectAll",function(){var a=d(e).val()||[];d.each(d(e).data("cache"),
function(b,c){-1===d.inArray(b,a)&&l(c,b,0,0,0)});f.parent().hide()})}function l(a,k,b,f,g){if(!p())return!1;var A="bit-box"+(f?" locked":""),f=Y(),j=document.createTextNode(c.show_values?n(k):n(a)),l=d('<a class="closebutton" href="#"></a>'),A=d('<li class="'+A+'" rel="'+k+'" id="pt_'+f+'"></li>').prepend(j).append(l);h.append(A);l.click(function(){z(d(this).parent("li"));return!1});b||(d("#"+o+"_annoninput").remove(),S(g),a=d('<option value="'+n(k,1)+'" id="opt_'+f+'" class="selected" selected="selected">'+
n(a)+"</option>"),e.append(a),c.onselect&&B(c.onselect,a),e.change());h.children("li.bit-box.deleted").removeClass("deleted");s(1);return f}function z(a){if(!a.hasClass("locked")){a.fadeOut("fast");var k=a.attr("id");if(c.onremove){var b=k?d("#o"+k+""):e.children("option[value="+a.attr("rel")+"]");B(c.onremove,b)}k?d("#o"+k+"").remove():e.children('option[value="'+a.attr("rel")+'"]').remove();a.remove();e.change();C=0}}function S(a){var k=d('<li class="bit-input" id="'+o+'_annoninput">'),b=d('<input type="text" class="maininput" size="'+
c.input_min_size+'" autocomplete="off">');0<c.input_tabindex&&b.attr("tabindex",c.input_tabindex);""!=c.input_name&&b.attr("name",c.input_name);h.append(k.append(b));b.focus(function(){D=!0;p()&&j.fadeIn("fast")});b.blur(function(){D=!1;E?j.fadeOut("fast"):b.focus()});h.click(function(){0>c.input_min_size&&f.length&&T(q(b.val(),1));b.focus();f.length&&b.val().length>c.input_min_size?f.show():(s(1),j.children(".default").show())});b.keypress(function(a){if(a.keyCode==r)return!1;a=c.input_min_size>
b.val().length?c.input_min_size:b.val().length+1;b.attr("size",a).width(parseInt(b.css("font-size"))*a)});b.keyup(function(a){var k=q(b.val(),1);if(a.keyCode==u&&0==k.length&&(s(1),!h.children("li.bit-box:last").hasClass("locked"))){if(0==h.children("li.bit-box.deleted").length)return h.children("li.bit-box:last").addClass("deleted"),!1;if(C)return;C=1;h.children("li.bit-box.deleted").fadeOut("fast",function(){z(d(this));return!1})}a.keyCode!=v&&a.keyCode!=w&&a.keyCode!=K&&a.keyCode!=L&&k.length>=
c.input_min_size&&(T(k),j.children(".default").hide(),f.show())});c.oncreate&&B(c.oncreate,b);a&&setTimeout(function(){b.focus();j.children(".default").show()},1)}function F(a,k){f.html("");!c.cache&&null!=k&&m.clear();Z(a);null!=k&&k.length&&d.each(k,function(a,b){m.set(q(b.key),q(b.value))});var b=c.maxshownitems<m.length()?c.maxshownitems:m.length(),h="";d.each(m.search(a),function(k,d){if(b&&(!c.filter_selected||!e.children('option[value="'+d.key+'"]').hasClass("selected"))){var f=h,g='<li rel="'+
d.key+'">',j=d.value,l=c.filter_begin?"<em>$1</em>$2":"$1<em>$2</em>$3",m=(c.filter_begin?"":"(.*)")+(c.filter_case?"("+a+")(.*)":"("+a.toLowerCase()+")(.*)");try{j=j.replace(RegExp(m,c.filter_case?"g":"gi"),l)}catch(o){}h=f+(g+n(j)+"</li>");t++;b--}});f.append(h);c.firstselected&&(g=f.children("li:visible:first"),g.addClass("auto-focus"));t>c.height?f.css({height:24*c.height+"px",overflow:"auto"}):f.css("height","auto");p()&&j.is(":hidden")&&j.show()}function U(){f.children("li").mouseover(function(){f.children("li").removeClass("auto-focus");
g=d(this);g.addClass("auto-focus")});f.children("li").mouseout(function(){d(this).removeClass("auto-focus");g=null})}function $(){f.unbind("mouseover").unbind("mouseout").mousemove(function(){U();f.unbind("mousemove")})}function G(){var a=d("#"+o+"_annoninput").children(".maininput");U();f.children("li").unbind("mousedown").mousedown(function(){var a=d(this);l(a.text(),a.attr("rel"),0,0,1);s(1);j.hide()});a.unbind("keydown");a.keydown(function(a){a.keyCode!=u&&h.children("li.bit-box.deleted").removeClass("deleted");
if((a.keyCode==r||a.keyCode==x||a.keyCode==y)&&!(null==g||0==g.length)){var b=g;l(b.text(),b.attr("rel"),0,0,1);return H(a)}if((a.keyCode==r||a.keyCode==x||a.keyCode==y)&&(null==g||0==g.length)){if(c.newel)return b=q(d(this).val()),l(b,b,0,0,1),H(a);if((c.addontab||c.addoncomma)&&c.newel)return b=g=f.children("li:visible:first"),l(b.text(),b.attr("rel"),0,0,1),H(a)}a.keyCode==v&&V("first");a.keyCode==w&&V("last")})}function V(a){$();if(null==g||0==g.length)g=f.children("li:visible:"+a),f.get(0).scrollTop=
"first"==a?0:parseInt(g.get(0).scrollHeight,10)*(parseInt(f.children("li:visible").length,10)-Math.round(c.height/2));else{g.removeClass("auto-focus");g="first"==a?g.nextAll("li:visible:first"):g.prevAll("li:visible:first");var d=parseInt(g.prevAll("li:visible").length,10),b=parseInt(g.nextAll("li:visible").length,10);if((("first"==a?d:b)>Math.round(c.height/2)||("first"==a?d:b)<=Math.round(c.height/2))&&"undefined"!=typeof g.get(0))f.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(d-Math.round(c.height/
2))}f.children("li").removeClass("auto-focus");g.addClass("auto-focus")}function H(a){j.hide();a.preventDefault();g=null;return!1}function p(){return 0!=c.maxitems&&h.children("li.bit-box").length<c.maxitems}function Z(a){c.newel&&p()&&(f.children("li[fckb=1]").remove(),0!=a.length&&(a=d('<li rel="'+a+'" fckb="1">').html(n(a)),f.prepend(a),t++))}function B(a,c){var b={};for(i=0;i<c.get(0).attributes.length;i++)null!=c.get(0).attributes[i].nodeValue&&(b["_"+c.get(0).attributes[i].nodeName]=c.get(0).attributes[i].nodeValue);
return a.call(a,b)}function q(a,c){if("undefined"!=typeof c){for(i=0;i<a.length;i++){var b=a.charCodeAt(i);if(M<=b&&b<=N||O<=b&&b<=P||Q<=b&&b<=R)a=a.replace(a[i],escape(a[i]))}a=a.replace(/(\{|\}|\*)/i,"\\$1")}return a.replace(/script(.*)/g,"")}function n(a,c){a=a.toString();a=a.replace("\\","");return"undefined"!=typeof c?a:unescape(a)}function s(a){f.children().remove();a&&f.hide()}function T(a){t=0;if(c.json_url&&p())if(c.cache&&I.get(a))F(a),G();else{J++;var e=J;setTimeout(function(){e==J&&d.getJSON(c.json_url,
{tag:n(a)},function(b){D&&(F(a,b),I.set(a,1),G())})},c.delay)}else F(a),G()}var c=d.extend({json_url:null,width:512,cache:!1,height:"10",newel:!1,addontab:!1,addoncomma:!1,firstselected:!1,filter_case:!1,filter_selected:!1,filter_begin:!1,complete_text:"Start to type...",select_all_text:null,maxshownitems:30,maxitems:10,oncreate:null,onselect:null,onremove:null,attachto:null,delay:350,input_tabindex:0,input_min_size:1,input_name:"",bricket:!0,show_values:!1,onchange:null,search_mode:"titles"},W),
h=null,f=null,j=null,t=0,D=!1,g=null,C=0,E=1,e=d(this),o=e.attr("id"),J=0,I={set:function(a,c){var b=e.data("jsoncache");b[a]=c;e.data("jsoncache",b)},get:function(a){return"undefined"!=e.data("jsoncache")[a]?e.data("jsoncache")[a]:null},init:function(){e.data("jsoncache",{})}};r=13;x=9;y=188;u=8;K=37;w=38;L=39;v=40;M=33;N=47;O=58;P=64;Q=91;R=96;var Y=function(){for(var a="",c=0;32>c;c++)var b=Math.floor(61*Math.random()),a=a+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(b,
b+1);return a},m={search:function(a){var f=[],b=RegExp((c.filter_begin?"^":"")+a,c.filter_case?"g":"gi"),g;d.each(e.data("cache"),function(a,d){g=!1;switch(c.search_mode){case "titles":"function"===typeof d.search&&-1!=d.search(b)&&(g=!0);break;case "values":"function"===typeof a.search&&-1!=a.search(b)&&(g=!0);break;case "all":"function"===typeof d.search&&-1!=d.search(b)?g=!0:"function"===typeof a.search&&-1!=a.search(b)&&(g=!0)}g&&f.push({key:a,value:d})});return f},set:function(a,c){var b=e.data("cache");
b[a]=c;e.data("cache",b)},get:function(a){return"undefined"!=e.data("cache")[a]?e.data("cache")[a]:null},clear:function(){e.data("cache",{})},length:function(){if("object"==typeof e.data("cache")){var a=0;for(i in e.data("cache"))a++;return a}return e.data("cache").length},init:function(){"undefined"==e.data("cache")&&e.data("cache",{})}};(function(){h=d('<ul class="holder"></ul>').width(c.width);c.attachto?"object"==typeof c.attachto?c.attachto.append(h):d(c.attachto).append(h):e.after(h);j=d('<div class="facebook-auto">').width(c.width);
""!=c.complete_text&&(j.append('<div class="default">'+c.complete_text+"</div>"),c.select_all_text&&j.children(".default").append(d('<a href="" class="select_all_items">'+c.select_all_text+"</a>").click(function(){d(e).trigger("selectAll");return!1})));j.hover(function(){E=0},function(){E=1});f=d('<ul id="'+o+'_feed"></ul>').width(c.width);h.after(j.prepend(f));X()})();S(0);I.init();m.init();return this})}})(jQuery);
